<p-toolbar styleClass="mb-6">
  <ng-template #start>
    <p-button label="New Request" icon="pi pi-plus" severity="secondary" class="mr-2" (onClick)="openNew()" />
  </ng-template>
</p-toolbar>

<p-table #dt [value]="requests" [rows]="10" [paginator]="true" [rowHover]="true" dataKey="id">
  <ng-template pTemplate="header">
    <tr>
      <th>Id</th>
      <th>Created</th>
      <th>Status</th>
      <th>Notes</th>
      <th></th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-r>
    <tr>
      <td>{{r.id}}</td>
      <td>{{r.createdAt | date:'short'}}</td>
      <td>{{r.status}}</td>
      <td>{{r.notes.length}}</td>
      <td>
        <p-button icon="pi pi-eye" (click)="view(r)"></p-button>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog header="New Sample Request" [(visible)]="dialog" [modal]="true" [style]="{ width: 'auto' }">
  <div class="p-fluid">
    <label class="block font-bold mb-2">Title</label>
    <input pInputText [(ngModel)]="title" />

    <label class="block font-bold mb-2">Product Code</label>
    <input pInputText [(ngModel)]="productCode" />

    <label class="block font-bold mb-2">Quantity</label>
    <input pInputText type="number" [(ngModel)]="quantity" />
  </div>
  <ng-template pTemplate="footer">
    <p-button label="Cancel" (onClick)="dialog=false" />
    <p-button label="Create" (onClick)="create()" />
  </ng-template>
</p-dialog>

<!-- View / Notes dialog -->
<p-dialog header="Request Details" [(visible)]="viewDialog" [modal]="true" [style]="{ width: '640px' }">
  <div *ngIf="selected">
    <p><strong>Id:</strong> {{selected.id}}</p>
    <p><strong>Product:</strong> {{selected.productCode}} ({{selected.quantity}})</p>
    <p><strong>Status:</strong> {{selected.status}}</p>
    <p><strong>Notes:</strong></p>
    <ul>
      <li *ngFor="let n of selected.notes">{{n.time | date:'short'}} â€” <strong>{{n.author}}</strong>: {{n.text}}</li>
    </ul>
    <div class="mt-4">
      <label class="block font-bold mb-2">Add note</label>
      <textarea pInputTextarea [(ngModel)]="noteText" rows="3"></textarea>
      <div class="mt-2">
        <p-button label="Add" icon="pi pi-plus" (onClick)="addNoteToSelected()"></p-button>
      </div>
    </div>
  </div>
</p-dialog>

