<p-toolbar styleClass="mb-6">
  <ng-template #start>
    <p-button label="New Request" icon="pi pi-plus" severity="secondary" class="mr-2" (onClick)="openNew()" />
  </ng-template>
</p-toolbar>

<p-table #dt [value]="requests" [rows]="10" [paginator]="true" [rowHover]="true" dataKey="id">
  <ng-template pTemplate="header">
    <tr>
      <th>Id</th>
      <th>Created</th>
      <th>Status</th>
      <th>Notes</th>
      <th></th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-r>
    <tr>
      <td>{{r.id}}</td>
      <td>{{r.createdAt | date:'short'}}</td>
      <td>{{r.status}}</td>
      <td>{{r.notes.length}}</td>
      <td>
        <p-button icon="pi pi-eye" (click)="view(r)"></p-button>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog header="New Sample Request" [(visible)]="dialog" [modal]="true" [style]="{ width: '560px' }" [closable]="true">
  <ng-template #content>
    <div class="grid grid-cols-12 gap-4 p-4">
      <div class="col-span-6">
        <label class="block text-sm font-semibold mb-1">Product Code</label>
        <input pInputText [(ngModel)]="productCode" class="w-full" placeholder="Ürün kodu girin" />
      </div>
      <div class="col-span-6">
        <label class="block text-sm font-semibold mb-1">Quantity</label>
        <input pInputText type="number" [(ngModel)]="quantity" class="w-full" placeholder="Adet" />
      </div>

      <div class="col-span-12">
        <label class="block text-sm font-semibold mb-1">Title (optional)</label>
        <input pInputText [(ngModel)]="title" class="w-full" placeholder="Kısa açıklama (isteğe bağlı)" />
      </div>
    </div>
  </ng-template>

  <ng-template #footer>
    <div class="flex justify-end gap-3 p-3">
      <p-button label="Cancel" icon="pi pi-times" class="p-button-text" (onClick)="dialog=false"></p-button>
      <p-button label="Create" icon="pi pi-check" (onClick)="create()"></p-button>
    </div>
  </ng-template>
</p-dialog>

<!-- View / Notes dialog (professional layout) -->
<p-dialog header="Request Details" [(visible)]="viewDialog" [modal]="true" [style]="{ width: '720px' }" [closable]="true">
  <ng-template #content>
    <div *ngIf="selected" class="p-4">
      <div class="grid grid-cols-12 gap-4 mb-4">
        <div class="col-span-6">
          <div class="text-sm text-muted">Id</div>
          <div class="font-medium">{{selected.id}}</div>
        </div>
        <div class="col-span-6">
          <div class="text-sm text-muted">Created</div>
          <div class="font-medium">{{selected.createdAt | date:'short'}}</div>
        </div>
        <div class="col-span-6 mt-3">
          <div class="text-sm text-muted">Product</div>
          <div class="font-medium">{{selected.productCode}} ({{selected.quantity}})</div>
        </div>
        <div class="col-span-6 mt-3">
          <div class="text-sm text-muted">Status</div>
          <div class="font-medium">{{selected.status}}</div>
        </div>
      </div>

      <div class="mb-3">
        <div class="text-sm text-muted mb-2">Notes</div>
        <div class="p-3 bg-white border rounded shadow-sm max-h-48 overflow-auto">
          <ul class="space-y-2">
            <li *ngFor="let n of selected.notes">
              <div class="text-xs text-muted">{{n.time | date:'short'}}</div>
              <div><strong>{{n.author}}</strong> <span class="text-sm">({{n.role ?? ''}})</span></div>
              <div class="mt-1">{{n.text}}</div>
            </li>
          </ul>
        </div>
      </div>

      <div>
        <label class="block text-sm font-semibold mb-1">Add note</label>
        <textarea pInputTextarea [(ngModel)]="noteText" rows="4" class="w-full"></textarea>
      </div>
    </div>
  </ng-template>

  <ng-template #footer>
    <div class="flex justify-end gap-3 p-3">
      <p-button label="Close" icon="pi pi-times" class="p-button-text" (onClick)="viewDialog=false"></p-button>
      <p-button label="Add" icon="pi pi-plus" (onClick)="addNoteToSelected()"></p-button>
    </div>
  </ng-template>
</p-dialog>

